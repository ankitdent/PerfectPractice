<script id="dataLayer-common">
  window.dataLayer = window.dataLayer || [];
  window.sgdAnalytics = {
    customerId: '{{customer.id}}',
    customerEmail: '{{customer.email}}',
    pageType: '{{request.page_type}}'
  };
  
{% if request.page_type == "product" %}
  sgdAnalytics.product = {
    price: '{{product.selected_or_first_available_variant.price | money_without_currency}}',
    sku: '{{product.selected_or_first_available_variant.sku}}',
    inventory_quantity: {{ product.selected_or_first_available_variant.inventory_quantity }},
    product: {{product | json}},
    firstAvailableVariant: {{  product.selected_or_first_available_variant | json }}
  }
{% elsif request.page_type == "cart" %}
  sgdAnalytics.cartItems = [];
  {% for line_item in cart.items %}
    sgdAnalytics.cartItems.push({
      linePrice: '{{ line_item.final_line_price | money_without_currency}}',
      sku: '{{ line_item.sku }}',
      quantity: '{{ line_item.quantity }}',
    });
  {% endfor %}
  
  sgdAnalytics.cart = {{cart | json}};
{% endif %}

// !function(){"use strict";function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var n="thrasio-dl--tracked";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}(".thrasio-dl--tracked{box-sizing:inherit}");var r=function(t){arguments[0].eventType="thrasio-dl",window.dataLayer.push.apply(window.dataLayer,arguments),window.dataLayer.push({event:"flush dataLayer",eventCategory:void 0,eventLabel:void 0,eventValue:void 0,ecommerce:void 0,attributes:void 0,eventType:void 0})},o=function(t,e,o,a,i){!function(t,e,r){t&&(t.classList.contains(n)||(t.addEventListener(e,r),t.classList.add(n)))}(t,"click",(function(){var t={event:e,eventCategory:o,eventLabel:a};i&&(t.attributes=i),r(t)}))},a=function(e,n){!function(t){var e=setInterval((function(){var n,r,o;null!==(n=window)&&void 0!==n&&null!==(r=n.ShopifyAnalytics)&&void 0!==r&&null!==(o=r.lib)&&void 0!==o&&o.track&&window.ShopifyAnalytics.lib.allIntegrationsHaveLoaded&&(t(),clearInterval(e))}),50)}((function(){window.ShopifyAnalytics.lib.track=new Proxy(window.ShopifyAnalytics.lib.track,{apply:function(r,o,a){var i=t(a,2),c=i[0],l=i[1];return c&&c===e&&n(l),Reflect.apply(r,o,a)}})}))};window.dlPush=r;var i,c={collection:"collection",index:"frontpage",product:"product detail","customers/account":"account",cart:"cart"};i=function(){var t;t=c[window.sgdAnalytics.pageType],a("Added Product",(function(e){r({event:"add to cart",eventCategory:t,eventLabel:e.sku,attributes:{products:[e]}})})),document.querySelectorAll("[dl-event-category]").forEach((function(t){var e=t.getAttribute("dl-event-category"),n=t.getAttribute("dl-event-name"),r=t.getAttribute("dl-event-label");o(t,n,e,r)}));var e=document.querySelector(".cart-popup-wrapper");new MutationObserver((function(){!e.classList.contains("is-transitioning")&&"0"!==window.getComputedStyle(e)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&r({eventCategory:"cart popup",event:"view"})})).observe(e,{attributes:!0}),function t(e,n){document.querySelectorAll(e).length<e.length?setTimeout(t.bind(null,e,n),50):n()}([".landing-page-custom .klaviyo-form-Yf8W3F form button"],(function(){document.querySelectorAll(".klaviyo-form-Yf8W3F").forEach((function(t){new MutationObserver((function(){t.querySelector('form input[type="email"]')||(r({event:"subscribe form submit",eventCategory:"subscribe landing page"}),fbq("track","Lead"))})).observe(t,{childList:!0,attributes:!0,subtree:!0})}))}))},"loading"!==document.readyState?i():document.addEventListener?document.addEventListener("DOMContentLoaded",i):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&i()}))}();
!function(){"use strict";var e=function e(t,n){document.querySelectorAll(t).length<t.length?setTimeout(e.bind(null,t,n),50):n()};function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var r="thrasio-dl--tracked";!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".thrasio-dl--tracked{box-sizing:inherit}");var o=function(e){arguments[0].eventType="thrasio-dl",window.dataLayer.push.apply(window.dataLayer,arguments),window.dataLayer.push({event:"flush dataLayer",eventCategory:void 0,eventLabel:void 0,eventValue:void 0,ecommerce:void 0,attributes:void 0,eventType:void 0})},i=function(e,t,n,i,a){!function(e,t,n){e&&(e.classList.contains(r)||(e.addEventListener(t,n),e.classList.add(r)))}(e,"click",(function(){var e={event:t,eventCategory:n,eventLabel:i};a&&(e.attributes=a),o(e)}))},a=function(e,n){!function(e){var t=setInterval((function(){var n,r,o;null!==(n=window)&&void 0!==n&&null!==(r=n.ShopifyAnalytics)&&void 0!==r&&null!==(o=r.lib)&&void 0!==o&&o.track&&window.ShopifyAnalytics.lib.allIntegrationsHaveLoaded&&(e(),clearInterval(t))}),50)}((function(){window.ShopifyAnalytics.lib.track=new Proxy(window.ShopifyAnalytics.lib.track,{apply:function(r,o,i){var a=t(i,2),c=a[0],l=a[1];return c&&c===e&&n(l),Reflect.apply(r,o,i)}})}))};window.dlPush=o;var c,l={collection:"collection",index:"frontpage",product:"product detail","customers/account":"account",cart:"cart"};c=function(){var t;t=l[window.sgdAnalytics.pageType],a("Added Product",(function(e){o({event:"add to cart",eventCategory:t,eventLabel:e.sku,attributes:{products:[e]}})})),document.querySelectorAll("[dl-event-category]").forEach((function(e){var t=e.getAttribute("dl-event-category"),n=e.getAttribute("dl-event-name"),r=e.getAttribute("dl-event-label");i(e,n,t,r)}));var n=document.querySelector(".cart-popup-wrapper");new MutationObserver((function(){!n.classList.contains("is-transitioning")&&"0"!==window.getComputedStyle(n)&&(n.offsetWidth||n.offsetHeight||n.getClientRects().length)&&o({eventCategory:"cart popup",event:"view"})})).observe(n,{attributes:!0}),e(['.landing-page-custom .klaviyo-form-Yf8W3F form input[type="email"]'],(function(){document.querySelectorAll(".klaviyo-form-Yf8W3F").forEach((function(e){new MutationObserver((function(){e.querySelector('form input[type="email"]')||(o({event:"subscribe form submit",eventCategory:"subscribe landing page"}),fbq("track","Lead"))})).observe(e,{childList:!0,subtree:!0})}))})),e(['.landing-page-custom .klaviyo-form-QQefdf form input[type="tel"]'],(function(){document.querySelectorAll(".klaviyo-form-QQefdf").forEach((function(e){new MutationObserver((function(){e.querySelector('form input[type="tel"]')||(o({event:"subscribe form submit",eventCategory:"subscribe landing page - mobile phone form"}),fbq("track","Lead"))})).observe(e,{childList:!0,subtree:!0})}))}))},"loading"!==document.readyState?c():document.addEventListener?document.addEventListener("DOMContentLoaded",c):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&c()}))}();

</script>


{% if request.page_type == 'product' %}
	{% render 'dataLayer.product' %}
{% elsif request.page_type == 'collection' %}
	{% render 'dataLayer.collection' %}
{% elsif request.page_type == 'cart' %}
	{% render 'dataLayer.cart' %}
{% elsif request.page_type == 'index' %}
	{% render 'dataLayer.index' %}
{% endif %} 
